# 数据挑战的通用行为建模基线解决方案

在此，我们为数据挑战提供一个基线解决方案。有关挑战和数据集的更多信息，请参阅根目录中的README。  
为了使用生成的表征进行训练，需要将数据拆分为输入和目标块，并基于输入事件文件生成嵌入。

**重要！请使用 `data_utils.split_data` 脚本进行数据拆分。运行该脚本的说明请参阅根目录README中[数据拆分](https://github.com/Synerise/recsys2025#data-splitting)部分。**

## 基线嵌入方法：特征聚合

该基线遵循现实行为建模领域中常见的特征工程实践，构建了两种类型的简单聚合特征：统计特征和查询特征。

### 统计特征

统计特征表示用户感兴趣的商品类别、价格和产品。这些特征对应用户过去交互的计数，例如：*用户在过去30天内购买特定商品X的次数*。

对于每个用户，我们考虑一组时间窗口（例如1天、1周、1个月），并按列值聚合事件数量。  
**例如：**  
上个月用户将以下商品加入购物车：3件属于类别X，2件属于类别Y；4件属于第3价格区间，1件属于第4价格区间。  
上个月用户购买了1件属于类别X且位于第3价格区间的商品。  
相同统计方法将应用于其他时间窗口和事件类型。

**注意**  
鉴于类别数量庞大，我们可能仅使用部分值来计算特征，因为所有事件类型和时间窗口的完整值集会产生非常大的向量。在特征计算中，我们将类别、价格区间或产品限制为前10个最流行的值。

### 查询特征

由于`search_query`事件类型包含用户搜索查询文本嵌入的整数量化向量，我们采用不同方法提取该事件类型的有价值信息。对于每个用户，我们通过取用户查询对应整数向量的平均值来构建新特征。

### 基线流程概览

用户特征从原始事件数据中提取。首先为每种事件类型单独计算特征，然后合并这些特征以生成信息丰富的用户表征（通用行为档案）。最终，在用户定义的`embedding_dir`中，以`.npy`文件格式保存包含`client_ids`的`np.ndarray`和对应的嵌入`np.ndarray`，符合竞赛提交格式要求。

## 创建竞赛提交嵌入

`create_embeddings.py`脚本基于选定事件类型生成示例竞赛提交。该脚本为每种事件类型生成特征并合并以创建用户表征，作为模型训练和验证的输入嵌入。脚本默认使用以下列进行统计特征计算：
 - `category`和`price`用于事件类型：`product_buy`、`add_to_cart`、`remove_from_cart`
 - `url`用于`page_visit`
 - `query`用于`search_query`

### 参数

- `--data-dir`：包含训练和目标数据的目录——由`data_utils.split_data`生成
- `--embeddings-dir`：保存符合竞赛格式的生成嵌入的目录
- `--num-days`：生成特征的时间窗口（天数）列表。每个时间窗口将生成不同特征集，聚合该时间段内的事件数据

  **例如：**  
  在`--num-days`参数中提供列表[1,7,30]，将为每个列值生成三个不同特征，例如：过去1、7、30天内购买的某类别商品数量。
  
- `--top-n`：特征生成时考虑的列值前N位数量

### 输出

用户ID和对应的嵌入向量将保存在`--embeddings-dir`目录下的两个文件中：`client_ids.npy`和`embeddings.npy`。

### 运行脚本

```bash
python -m baseline.aggregated_features_baseline.create_embeddings --data-dir <拆分后的挑战数据目录> --embeddings-dir <你的嵌入目录>
```